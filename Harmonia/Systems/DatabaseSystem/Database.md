# Database

Provides a central interface for working with databases.

This class manages connections and executes queries on the application
database. Connection details are retrieved from the configuration.

## Methods

### Execute

Executes a query on the database.

#### Syntax

```php
public function Execute(\Harmonia\Systems\DatabaseSystem\Queries\Query $query): ?\Harmonia\Systems\DatabaseSystem\ResultSet
```

#### Parameters

- **$query**: The query object containing SQL and optionally its bindings.

#### Return Value

A `ResultSet` if the query executes successfully. For queries that produce a result set (such as `SELECT`, `SHOW`, `DESCRIBE`, `EXPLAIN`), the result contains rows. For queries that do not produce a result set (such as `INSERT`, `UPDATE`, `DELETE`, `REPLACE`), the result is empty. Returns `null` if a database connection is unavailable or if the query fails. In case of failure, the error is written to the log file.

---

### LastInsertId

Retrieves the ID generated by the last `INSERT` query.

#### Syntax

```php
public function LastInsertId(): int
```

#### Return Value

The auto-generated ID from the last successful `INSERT` query. Returns `0` if the last query was not an `INSERT`, if no `AUTO_INCREMENT` value was generated, or if a database connection is unavailable.

---

### LastAffectedRowCount

Retrieves the number of rows affected by the last `INSERT`, `UPDATE`,
`REPLACE`, or `DELETE` query.

#### Syntax

```php
public function LastAffectedRowCount(): int
```

#### Return Value

The number of rows affected by the last modifying query. Returns `0` if no rows were affected. Returns `-1` if the query fails, or if a database connection is unavailable.

---

### WithTransaction

Executes a callable within a database transaction.

This method initiates a transaction, executes the provided callback, and
commits the transaction if no exception is thrown.

#### Syntax

```php
public function WithTransaction(callable $callback): void
```

#### Parameters

- **$callback**: The callback function to execute within the transaction. It may throw an exception to signal an error.

#### Exceptions

- **\Throwable**: If no database connection is available, if the callback throws an exception, or if beginning, committing, or rolling back the transaction fails.

---

### EscapeString

Escapes special characters in a string for use in SQL statements.

This method is intended for use in SQL queries where parameter binding
is not supported by the database engine (e.g., `SHOW DATABASES LIKE`).
It helps prevent SQL injection by escaping input values.

The returned value is not quoted automatically. It is the caller's
responsibility to wrap the result in single quotes when embedding it
directly in a SQL string.

#### Example
```php
$sql = "SHOW DATABASES LIKE '{$database->EscapeString($name)}'";
```

#### Syntax

```php
public function EscapeString(string $string): string
```

#### Parameters

- **$string**: The string to be escaped.

#### Return Value

The escaped string, safe for use in SQL contexts when properly quoted. If the connection is unavailable, an empty string is returned.

---

*This documentation was automatically generated using [phpDocumentor](http://www.phpdoc.org/) with the [Calliope](https://github.com/DaphneWebFramework/Calliope) template.*
